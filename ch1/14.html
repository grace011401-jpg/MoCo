<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sensor Test</title>
</head>
<body>

<h2>感測器測試</h2>
<button id="startBtn">啟用感測器</button>

<h3>方向</h3>
<p>alpha: <span id="alpha">-</span></p>
<p>beta: <span id="beta">-</span></p>
<p>gamma: <span id="gamma">-</span></p>

<h3>加速度</h3>
<p>x: <span id="ax">-</span></p>
<p>y: <span id="ay">-</span></p>
<p>z: <span id="az">-</span></p>

<h3>加速度(含重力)</h3>
<p>x_g: <span id="axg">-</span></p>
<p>y_g: <span id="ayg">-</span></p>
<p>z_g: <span id="azg">-</span></p>

<h3>旋轉速率</h3>
<p>alpha(速): <span id="ralpha">-</span></p>
<p>beta(速): <span id="rbeta">-</span></p>
<p>gamma(速): <span id="rgamma">-</span></p>

<script>
// iPhone 要求權限
async function askPermission() {
  if (typeof DeviceMotionEvent.requestPermission === "function") {
    try {
      let r = await DeviceMotionEvent.requestPermission();
      return r === "granted";
    } catch (e) {
      return false;
    }
  }
  return true; // Android 不用
}

document.getElementById("startBtn").onclick = async function () {
  let ok = await askPermission();
  if (!ok) {
    alert("沒有權限無法使用感測器");
    return;
  }

  window.addEventListener("deviceorientation", function (e) {
    document.getElementById("alpha").innerText = e.alpha ? e.alpha.toFixed(2) : "-";
    document.getElementById("beta").innerText = e.beta ? e.beta.toFixed(2) : "-";
    document.getElementById("gamma").innerText = e.gamma ? e.gamma.toFixed(2) : "-";
  });

  window.addEventListener("devicemotion", function (e) {
    let a = e.acceleration || {};
    document.getElementById("ax").innerText = a.x ? a.x.toFixed(2) : "-";
    document.getElementById("ay").innerText = a.y ? a.y.toFixed(2) : "-";
    document.getElementById("az").innerText = a.z ? a.z.toFixed(2) : "-";

    let ag = e.accelerationIncludingGravity || {};
    document.getElementById("axg").innerText = ag.x ? ag.x.toFixed(2) : "-";
    document.getElementById("ayg").innerText = ag.y ? ag.y.toFixed(2) : "-";
    document.getElementById("azg").innerText = ag.z ? ag.z.toFixed(2) : "-";

    let rot = e.rotationRate || {};
    document.getElementById("ralpha").innerText = rot.alpha ? rot.alpha.toFixed(2) : "-";
    document.getElementById("rbeta").innerText = rot.beta ? rot.beta.toFixed(2) : "-";
    document.getElementById("rgamma").innerText = rot.gamma ? rot.gamma.toFixed(2) : "-";
  });

  this.disabled = true;
  this.innerText = "已啟用";
};
</script>

</body>
</html>
